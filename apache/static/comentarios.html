<!DOCTYPE html>

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comentarios - CarShop</title>

```
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">

<style>
    .oculto{
        display: none;
    }
</style>

<script>
    var myHeaders = new Headers();
    myHeaders.append("Content-Type", "application/json");

    onload = function () {
        pedirComentarios();
    }

    function pedirComentarios() {
        fetch("/api/comentarios/", {
            method: "GET",
            headers: myHeaders
        })
        .then(response => response.json())
        .then(result => {
            pintarComentarios(result);
        })
        .catch(error => {
            console.log(error);
            alert("Error al cargar los comentarios");
        });
    }

    function pintarComentarios(lista) {
        let tbody = document.getElementsByTagName("tbody")[0];
        tbody.innerHTML = "";

        lista.forEach(comentario => {
            let fila = `
                <tr>
                    <td>${comentario.email}</td>
                    <td>${comentario.descripcion}</td>
                </tr>
            `;
            tbody.innerHTML += fila;
        });
    }

    function guardarComentario() {
        let datos = JSON.stringify({
            email: document.getElementById("email").value,
            descripcion: document.getElementById("descripcion").value
        });

        fetch("/api/comentarios/", {
            method: "POST",
            headers: myHeaders,
            body: datos
        })
        .then(response => response.json())
        .then(result => {
            if (result.status === "OK") {
                alert("Comentario a침adido");
                document.getElementById("email").value = "";
                document.getElementById("descripcion").value = "";
                pedirComentarios();
            } else {
                alert("No se pudo guardar el comentario");
            }
        })
        .catch(error => {
            console.log(error);
            alert("Error al guardar el comentario");
        });
    }

    function cerrarSesion(){
        fetch("/api/usuarios/logout", {
            method: "GET",
            headers: myHeaders
        })
        .then(response => response.json())
        .then(result => {
            if (result.status === "OK") {
                location.href = "index.html";
            } else {
                alert("No se ha podido cerrar sesi칩n");
            }
        })
        .catch(error => {
            console.log(error);
            alert("Error al cerrar sesi칩n");
        });
    }
</script>
```

</head>

<body>

<nav class="navbar is-warning" role="navigation">
    <div class="navbar-menu">
        <div class="navbar-start">
            <a class="navbar-item" href="coches.html">Coches</a>
            <a class="navbar-item" href="comentarios.html">Comentarios</a>
            <a class="navbar-item" href="ficheros.html">Archivos</a>
            <a class="navbar-item" href="javascript:cerrarSesion()">Cerrar sesi칩n</a>
        </div>
    </div>
</nav>

<section class="section">
    <div class="columns">
        <div class="column">
            <h3 class="is-size-3">Comentarios</h3>

```
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Comentario</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

<hr>

<div class="columns">
    <div class="column is-half">
        <h3 class="is-size-4">Agregar comentario</h3>

        <div class="field">
            <label class="label">Email</label>
            <div class="control">
                <input class="input" type="text" id="email" placeholder="usuario@email.com" required>
            </div>
        </div>

        <div class="field">
            <label class="label">Comentario</label>
            <div class="control">
                <input class="input" type="text" id="descripcion" placeholder="Escribe tu comentario" required>
            </div>
        </div>

        <button class="button is-success" onclick="guardarComentario()">Guardar</button>
    </div>
</div>
```

</section>

</body>
</html>
